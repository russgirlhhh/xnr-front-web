import{c as m,o as i,d as T,b as p,m as v,e as d,p as e,w as y,s as I,h as V,_ as j,u as P,t as h,g as G,q as N,f as R,J as F,K as b,v as W,x as J,a as H,z as M,l as z,y as O,n as K}from"./index-CEFTijA-.js";import{h as Q,i as X,j as Y,k as Z,m as ee,n as te}from"./api-whLdgNP3.js";const B={__name:"CommentImage",props:{src:{type:String},imgList:{type:Array}},setup(n){return(w,U)=>{const _=m("el-image");return i(),T(_,{class:"comment-img",src:n.src,"zoom-rate":1.2,"preview-src-list":n.imgList?n.imgList:[n.src],"initial-index":0,fit:"scale-down",loading:"lazy","hide-on-click-modal":""},null,8,["src","preview-src-list"])}}},ne={class:"post-comment-panel"},oe={class:"comment-form"},se={key:0,class:"insert-img"},ae={key:0,class:"pre-img"},le=e("span",{class:"iconfont xnr-icon-picture"},null,-1),E={__name:"PostComment",props:{articleId:{type:String},pCommentId:{type:Number},replyUserId:{type:String},avatarWidth:{type:Number},userId:{type:String},showInsertImg:{type:Boolean},placeholderInfo:{type:String,default:"请输入评论内容"}},emits:["postCommentFinish"],setup(n,{emit:w}){const{proxy:U}=V(),_=n,g=(l,t,o)=>{t==null&&u.value.image==null?o(new Error(l.message)):o()},u=p({}),s=p(),r={content:[{required:!0,message:"请输入评论内容",validator:g},{min:5,message:"评论至少5个字"}]},L=w,$=()=>{s.value.validate(async l=>{if(!l)return;let t=Object.assign({},u.value);t.articleId=_.articleId,t.pCommentId=_.pCommentId,t.replyUserId=_.replyUserId;let o=await Q(t);o&&(U.Message.success("评论发表成功"),s.value.resetFields(),f(),L("postCommentFinish",o.data))})},C=p(null),D=l=>{l=l.file;let t=new FileReader;t.readAsDataURL(l),t.onload=({target:o})=>{let a=o.result;C.value=a,u.value.image=l}},f=()=>{C.value=null,u.value.image=null};return(l,t)=>{const o=m("Avatar"),a=m("el-input"),k=m("el-upload"),x=m("el-form-item"),S=m("el-form");return i(),v("div",ne,[d(o,{width:n.avatarWidth,userId:n.userId},null,8,["width","userId"]),e("div",oe,[d(S,{model:u.value,rules:r,ref_key:"formDataRef",ref:s},{default:y(()=>[d(x,{prop:"content"},{default:y(()=>[d(a,{clearable:"",placeholder:n.placeholderInfo,type:"textarea",maxlength:800,resize:"none","show-word-limit":"",modelValue:u.value.content,"onUpdate:modelValue":t[0]||(t[0]=c=>u.value.content=c)},null,8,["placeholder","modelValue"]),n.showInsertImg?(i(),v("div",se,[C.value?(i(),v("div",ae,[d(B,{src:C.value},null,8,["src"]),e("span",{class:"iconfont xnr-icon-remove",onClick:f})])):(i(),T(k,{key:1,name:"file","show-file-list":!1,accept:".png,.PNG,.jpg,.JPG,.jpeg,.JPEG,.gif,.GIF,.bmp,.BMP",multiple:!1,"http-request":D},{default:y(()=>[le]),_:1}))])):I("",!0)]),_:1})]),_:1},8,["model"])]),e("div",{class:"send-btn",onClick:$},"发表")])}}},q=n=>(W("data-v-08af6f30"),n=n(),J(),n),ie={class:"comment-item"},ce={class:"comment-info"},re={class:"nick-name"},de={key:0,class:"tag-author"},me={class:"comment-content"},ue={key:0,class:"tag tag-topping"},ve={key:1,class:"tag no-audit"},pe=["innerHTML"],_e={class:"op-panel"},Ie={class:"time"},he=q(()=>e("span",{class:"icon xnr-icon-more"},null,-1)),ge={key:0,class:"comment-sub-list"},fe={class:"comment-sub-item"},ye={class:"comment-sub-info"},Ce={class:"nick-name"},ke=["onClick"],we={key:0,class:"tag-author"},$e=q(()=>e("span",{class:"reply-name"},"回复",-1)),De=["onClick"],Ue=q(()=>e("span",null,"：",-1)),Le=["innerHTML"],xe={class:"op-panel"},Te={class:"time"},Re=["onClick"],Se=["onClick"],Ae={key:1,class:"reply-info"},Ne={__name:"CommentListItem",props:{articleId:{type:String},commentData:{type:Object},articleUserId:{type:String},currentUserId:{type:String}},emits:["hiddenAllReply","reloadData"],setup(n,{emit:w}){const{proxy:U}=V(),_=P(),g=n,u=p(0),s=p(null),r=p(null),L=w,$=(t,o)=>{const a=g.commentData.showReply==null?!1:g.commentData.showReply;L("hiddenAllReply"),o==0?g.commentData.showReply=!a:g.commentData.showReply=!0,u.value=g.commentData.commentId,s.value=t.userId,r.value="回复 @"+t.nickName},C=t=>{g.commentData.children=t},D=t=>{_.push(`/user/${t}`)},f=async t=>{let o={commentId:t.commentId,showLoading:!1},a=await X(o);a&&(t.goodCount=a.data.goodCount,t.likeType=a.data.likeType)},l=async t=>{let o={commentId:t.commentId,topType:t.topType==1?0:1};await Y(o)&&L("reloadData")};return(t,o)=>{const a=m("Avatar"),k=m("el-dropdown-item"),x=m("el-dropdown-menu"),S=m("el-dropdown");return i(),v("div",ie,[d(a,{userId:n.commentData.userId,width:50},null,8,["userId"]),e("div",ce,[e("div",re,[e("span",{class:"name",onClick:o[0]||(o[0]=c=>D(n.commentData.userId))},h(n.commentData.nickName),1),n.commentData.userId==n.articleUserId?(i(),v("span",de,"作者")):I("",!0)]),e("div",me,[e("div",null,[n.commentData.topType==1?(i(),v("span",ue,"置顶")):I("",!0),n.commentData.status==0?(i(),v("span",ve,"待审核")):I("",!0),e("span",{innerHTML:n.commentData.content},null,8,pe)]),n.commentData.imgPath?(i(),T(B,{key:0,src:G(U).globalInfo.imageUrl+n.commentData.imgPath.replace(".","_.")},null,8,["src"])):I("",!0)]),e("div",_e,[e("div",Ie,[e("span",null,h(n.commentData.postTime),1)]),e("div",{class:N(["icon xnr-icon-good",n.commentData.likeType==1?"active":""]),onClick:o[1]||(o[1]=c=>f(n.commentData))},h(n.commentData.goodCount>0?n.commentData.goodCount:"点赞"),3),e("div",{class:"icon xnr-icon-comment",onClick:o[2]||(o[2]=c=>$(n.commentData,0))}," 回复 "),n.articleUserId==n.currentUserId?(i(),T(S,{key:0},{dropdown:y(()=>[d(x,null,{default:y(()=>[d(k,{onClick:o[3]||(o[3]=c=>l(n.commentData))},{default:y(()=>[R(h(n.commentData.topType==0?"设为置顶":"取消置顶"),1)]),_:1})]),_:1})]),default:y(()=>[he]),_:1})):I("",!0)]),n.commentData.children?(i(),v("div",ge,[(i(!0),v(F,null,b(n.commentData.children,c=>(i(),v("div",fe,[d(a,{userId:c.userId,width:30},null,8,["userId"]),e("div",ye,[e("div",Ce,[e("span",{class:"name",onClick:A=>D(c.userId)},h(c.nickName),9,ke),c.userId==n.articleUserId?(i(),v("span",we,"作者")):I("",!0),$e,e("span",{onClick:A=>D(c.replyUserId),class:"a-link"},"@"+h(c.replyNickName),9,De),Ue,e("span",{class:"sub-content",innerHTML:c.content},null,8,Le)]),e("div",xe,[e("div",Te,[e("span",null,h(c.postTime),1)]),e("div",{class:N(["icon xnr-icon-good",c.likeType==1?"active":""]),onClick:A=>f(c)},h(c.goodCount>0?c.goodCount:"点赞"),11,Re),e("div",{class:"icon xnr-icon-comment",onClick:A=>$(c,1)}," 回复 ",8,Se)])])]))),256))])):I("",!0),n.commentData.showReply?(i(),v("div",Ae,[d(E,{articleId:n.articleId,avatarWidth:30,pCommentId:u.value,placeholderInfo:r.value,replyUserId:s.value,userId:n.currentUserId,showInsertImg:!1,onPostCommentFinish:C},null,8,["articleId","pCommentId","placeholderInfo","replyUserId","userId"])])):I("",!0)])])}}},Pe=j(Ne,[["__scopeId","data-v-08af6f30"]]),qe={class:"comment-body"},Ve={class:"comment-title"},Fe={class:"title"},be={class:"count"},He={class:"tab"},Me={class:"comment-form-panel"},ze={key:0},Be={class:"comment-list"},Ee={__name:"CommentList",props:{articleId:{type:String},articleUserId:{type:String}},emits:["updateCommentCount"],setup(n,{emit:w}){const U=z();P(),H();const _=n,g=()=>{r.value.list.forEach(l=>{l.showReply=!1})},u=p(0),s=l=>{u.value=l,$()};console.log(_);const r=p({}),L=p(null),$=async()=>{let l={articleId:_.articleId,opderType:u.value},t=await Z(l);t&&(r.value=t.data)};$();const C=w,D=l=>{r.value.list.unshift(l);const t=r.value.totalCount+1;r.value.totalCount=t,C("updateCommentCount",t)},f=p({});return M(()=>U.state.loginUserInfo,(l,t)=>{f.value=l||{}},{immediate:!0,deep:!0}),(l,t)=>{const o=m("el-divider"),a=m("NoData");return i(),v("div",qe,[e("div",Ve,[e("div",Fe,[R("评论 "),e("span",be,h(r.value.totalCount),1)]),e("div",He,[e("span",{onClick:t[0]||(t[0]=k=>s(0)),class:N(["tab-item",u.value==0?"active":""])},"热榜",2),d(o,{direction:"vertical"}),e("span",{onClick:t[1]||(t[1]=k=>s(1)),class:N(["tab-item",u.value==1?"active":""])},"最新",2)])]),e("div",Me,[d(E,{articleId:n.articleId,pCommentId:0,avatarWidth:50,userId:f.value.userId,showInsertImg:f.value.userId!=null,onPostCommentFinish:D},null,8,["articleId","userId","showInsertImg"])]),!L.value&&r.value.list!=null&&r.value.list.length==0?(i(),v("div",ze,[d(a,{msg:"暂无评论，快来抢占沙发吧"})])):I("",!0),(i(!0),v(F,null,b(r.value.list,k=>(i(),v("div",Be,[d(Pe,{articleId:n.articleId,commentData:k,articleUserId:_.articleUserId,currentUserId:f.value.userId,onHiddenAllReply:g,onReloadData:$},null,8,["articleId","commentData","articleUserId","currentUserId"])]))),256))])}}},je={class:"art"},Ge={class:"top"},We={class:"title"},Je={class:"author"},Oe={class:"pho"},Ke={class:"ntm"},Qe={class:"time"},Xe=e("i",{class:"xnr-icon-zhengyan"},null,-1),Ye=e("span",{class:"iconfont xnr-icon-edit"},"编辑",-1),Ze={class:"art-main"},et=["innerHTML"],tt={class:"quick-panel"},nt=e("span",{class:"iconfont xnr-icon-comment"},null,-1),ot=[nt],st=e("div",{class:"divider"},null,-1),at={class:"pinglun",id:"view-comment"},rt={__name:"Article",setup(n){const w=z();P();const U=H(),_=p({}),g=t=>{document.querySelector("#"+t).scrollIntoView()};p({});const u=p({}),s=p({}),r=p(!1),L=async t=>{let a=await ee({articleId:t});a&&(s.value=a.data.forumArticle,u.value=a.data.attchment,r.value=a.data.haveLike,f())},$=async()=>{if(!w.getters.getLoginUserInfo){w.commit("showLogin",!0);return}let t={articleId:s.value.articleId};if(!await te(t))return;r.value=!r.value;let a=1;r.value||(a=-1),s.value.goodCount=s.value.goodCount+a};O(()=>{L(U.params.articleId)});const C=p(null),D=p([]),f=()=>{K(()=>{const t=document.querySelector("#detail").querySelectorAll("img"),o=[];t.forEach((a,k)=>{const x=a.getAttribute("src");o.push(x),a.addEventListener("click",()=>{C.value.show(k)})}),D.value=o})},l=t=>{s.value.commentCount=t};return M(()=>w.state.loginUserInfo,(t,o)=>{_.value=t||{}},{immediate:!0,deep:!0}),(t,o)=>{const a=m("el-tag"),k=m("Avatar"),x=m("router-link"),S=m("el-divider"),c=m("el-badge"),A=m("ImageViewer");return i(),v("div",je,[e("div",Ge,[e("div",We,[R(h(s.value.title)+" ",1),s.value.status==0?(i(),T(a,{key:0,type:"danger"},{default:y(()=>[R("待审核")]),_:1})):I("",!0)]),e("div",Je,[e("div",Oe,[d(k,{userId:s.value.userId,width:45},null,8,["userId"])]),e("div",Ke,[d(x,{class:"name",to:`/user/${s.value.userId}`},{default:y(()=>[R(h(s.value.nickName),1)]),_:1},8,["to"]),e("div",Qe,[e("span",null,h(s.value.postTime),1),d(S,{direction:"vertical"}),Xe,R(" "+h(s.value.readCount==0?"阅读":s.value.readCount)+" ",1),s.value.userId==_.value.userId?(i(),T(x,{key:0,to:`/rePublish/${s.value.articleId}`,class:"a-link btn-edit"},{default:y(()=>[Ye]),_:1},8,["to"])):I("",!0)])])])]),e("div",Ze,[e("div",{class:"detail",id:"detail",innerHTML:s.value.content},null,8,et),e("div",tt,[d(c,{value:s.value.goodCount,type:"info",hidden:!s.value.goodCount>0},{default:y(()=>[e("div",{class:"quick-item",onClick:$},[e("span",{class:N(["iconfont xnr-icon-good",r.value?"have-like":""])},null,2)])]),_:1},8,["value","hidden"]),d(c,{value:s.value.commentCount,type:"info",hidden:!s.value.commentCount>0},{default:y(()=>[e("div",{class:"quick-item",onClick:o[0]||(o[0]=lt=>g("view-comment"))},ot)]),_:1},8,["value","hidden"])])]),st,d(A,{ref_key:"imageViewerRef",ref:C,imageList:D.value},null,8,["imageList"]),e("div",at,[s.value.articleId?(i(),T(Ee,{key:0,articleId:s.value.articleId,articleUserId:s.value.userId,onUpdateCommentCount:l},null,8,["articleId","articleUserId"])):I("",!0)])])}}};export{rt as default};
