import{u as ee,a as te,r as Y,b as R,c as y,o as V,d as K,w as u,e as c,f as L,t as re,g as Z,h as oe,n as Q,i as ie,j as ue,k as de,_ as fe,l as le,m as J,p as d,q as G,s as M,v as ce,x as pe,y as he,z as X,A as _e,B as ve,C as me}from"./index-CEFTijA-.js";import{r as xe,g as ge,a as we,b as ye}from"./api-whLdgNP3.js";const be="/assets/logo-CFJxAgHG.jpg",ke={__name:"UserEditUserInfo",emits:["resetUserInfo"],setup(B,{expose:$,emit:O}){const{proxy:g}=oe(),m=ee();te();const h=Y({show:!1,title:"编辑个人信息",buttons:[{type:"primary",text:"确定",click:k=>{p()}}]}),b=R({}),N=R(),_=O,p=()=>{N.value.validate(async k=>{if(!k)return;let v={};Object.assign(v,b.value),await xe(v)&&(h.show=!1,v.avatar instanceof File?m.go(0):_("resetUserInfo",v))})};return $({showEditUserInfoDialog:k=>{h.show=!0,Q(()=>{N.value.resetFields();const v=JSON.parse(JSON.stringify(k));v.avatar={imageUrl:v.userId},b.value=v})}}),(k,v)=>{const C=y("el-form-item"),x=y("CoverUpload"),E=y("el-radio"),A=y("el-radio-group"),D=y("el-input"),F=y("el-form"),S=y("aDialog");return V(),K(S,{show:h.show,title:h.title,buttons:h.buttons,width:"450px",showCancel:!1,onClose:v[3]||(v[3]=I=>h.show=!1)},{default:u(()=>[c(F,{model:b.value,ref_key:"formDataRef",ref:N,"label-width":"40px"},{default:u(()=>[c(C,{label:"昵称",prop:"nickeName"},{default:u(()=>[L(re(b.value.nickName),1)]),_:1}),c(C,{label:"头像",prop:"avatar"},{default:u(()=>[c(x,{imageUlrPrefix:Z(g).globalInfo.avatarUrl,modelValue:b.value.avatar,"onUpdate:modelValue":v[0]||(v[0]=I=>b.value.avatar=I)},null,8,["imageUlrPrefix","modelValue"])]),_:1}),c(C,{label:"性别",prop:"sex"},{default:u(()=>[c(A,{modelValue:b.value.sex,"onUpdate:modelValue":v[1]||(v[1]=I=>b.value.sex=I)},{default:u(()=>[c(E,{label:0},{default:u(()=>[L("女")]),_:1}),c(E,{label:1},{default:u(()=>[L("男")]),_:1})]),_:1},8,["modelValue"])]),_:1}),c(C,{label:"",prop:""},{default:u(()=>[c(D,{clearable:"",placeholder:"请输入简介",type:"textarea",rows:5,maxlength:100,resize:"none","show-word-limit":"",modelValue:b.value.personDescription,"onUpdate:modelValue":v[2]||(v[2]=I=>b.value.personDescription=I)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])}}};var ne={exports:{}};const Ce={},Fe=Object.freeze(Object.defineProperty({__proto__:null,default:Ce},Symbol.toStringTag,{value:"Module"})),ae=ie(Fe);/**
 * [js-md5]{@link https://github.com/emn178/js-md5}
 *
 * @namespace md5
 * @version 0.8.3
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2023
 * @license MIT
 */(function(B){(function(){var $="input is invalid type",O="finalize already called",g=typeof window=="object",m=g?window:{};m.JS_MD5_NO_WINDOW&&(g=!1);var h=!g&&typeof self=="object",b=!m.JS_MD5_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;b?m=ue:h&&(m=self);var N=!m.JS_MD5_NO_COMMON_JS&&!0&&B.exports,_=!m.JS_MD5_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",p="0123456789abcdef".split(""),q=[128,32768,8388608,-2147483648],k=[0,8,16,24],v=["hex","array","digest","buffer","arrayBuffer","base64"],C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),x=[],E;if(_){var A=new ArrayBuffer(68);E=new Uint8Array(A),x=new Uint32Array(A)}var D=Array.isArray;(m.JS_MD5_NO_NODE_JS||!D)&&(D=function(e){return Object.prototype.toString.call(e)==="[object Array]"});var F=ArrayBuffer.isView;_&&(m.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW||!F)&&(F=function(e){return typeof e=="object"&&e.buffer&&e.buffer.constructor===ArrayBuffer});var S=function(e){var o=typeof e;if(o==="string")return[e,!0];if(o!=="object"||e===null)throw new Error($);if(_&&e.constructor===ArrayBuffer)return[new Uint8Array(e),!1];if(!D(e)&&!F(e))throw new Error($);return[e,!1]},I=function(e){return function(o){return new n(!0).update(o)[e]()}},H=function(){var e=I("hex");b&&(e=P(e)),e.create=function(){return new n},e.update=function(t){return e.create().update(t)};for(var o=0;o<v.length;++o){var s=v[o];e[s]=I(s)}return e},P=function(e){var o=ae,s=ae.Buffer,t;s.from&&!m.JS_MD5_NO_BUFFER_FROM?t=s.from:t=function(r){return new s(r)};var i=function(r){if(typeof r=="string")return o.createHash("md5").update(r,"utf8").digest("hex");if(r==null)throw new Error($);return r.constructor===ArrayBuffer&&(r=new Uint8Array(r)),D(r)||F(r)||r.constructor===s?o.createHash("md5").update(t(r)).digest("hex"):e(r)};return i},T=function(e){return function(o,s){return new l(o,!0).update(s)[e]()}},W=function(){var e=T("hex");e.create=function(t){return new l(t)},e.update=function(t,i){return e.create(t).update(i)};for(var o=0;o<v.length;++o){var s=v[o];e[s]=T(s)}return e};function n(e){if(e)x[0]=x[16]=x[1]=x[2]=x[3]=x[4]=x[5]=x[6]=x[7]=x[8]=x[9]=x[10]=x[11]=x[12]=x[13]=x[14]=x[15]=0,this.blocks=x,this.buffer8=E;else if(_){var o=new ArrayBuffer(68);this.buffer8=new Uint8Array(o),this.blocks=new Uint32Array(o)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}n.prototype.update=function(e){if(this.finalized)throw new Error(O);var o=S(e);e=o[0];for(var s=o[1],t,i=0,r,a=e.length,f=this.blocks,U=this.buffer8;i<a;){if(this.hashed&&(this.hashed=!1,f[0]=f[16],f[16]=f[1]=f[2]=f[3]=f[4]=f[5]=f[6]=f[7]=f[8]=f[9]=f[10]=f[11]=f[12]=f[13]=f[14]=f[15]=0),s)if(_)for(r=this.start;i<a&&r<64;++i)t=e.charCodeAt(i),t<128?U[r++]=t:t<2048?(U[r++]=192|t>>>6,U[r++]=128|t&63):t<55296||t>=57344?(U[r++]=224|t>>>12,U[r++]=128|t>>>6&63,U[r++]=128|t&63):(t=65536+((t&1023)<<10|e.charCodeAt(++i)&1023),U[r++]=240|t>>>18,U[r++]=128|t>>>12&63,U[r++]=128|t>>>6&63,U[r++]=128|t&63);else for(r=this.start;i<a&&r<64;++i)t=e.charCodeAt(i),t<128?f[r>>>2]|=t<<k[r++&3]:t<2048?(f[r>>>2]|=(192|t>>>6)<<k[r++&3],f[r>>>2]|=(128|t&63)<<k[r++&3]):t<55296||t>=57344?(f[r>>>2]|=(224|t>>>12)<<k[r++&3],f[r>>>2]|=(128|t>>>6&63)<<k[r++&3],f[r>>>2]|=(128|t&63)<<k[r++&3]):(t=65536+((t&1023)<<10|e.charCodeAt(++i)&1023),f[r>>>2]|=(240|t>>>18)<<k[r++&3],f[r>>>2]|=(128|t>>>12&63)<<k[r++&3],f[r>>>2]|=(128|t>>>6&63)<<k[r++&3],f[r>>>2]|=(128|t&63)<<k[r++&3]);else if(_)for(r=this.start;i<a&&r<64;++i)U[r++]=e[i];else for(r=this.start;i<a&&r<64;++i)f[r>>>2]|=e[i]<<k[r++&3];this.lastByteIndex=r,this.bytes+=r-this.start,r>=64?(this.start=r-64,this.hash(),this.hashed=!0):this.start=r}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this},n.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,o=this.lastByteIndex;e[o>>>2]|=q[o&3],o>=56&&(this.hashed||this.hash(),e[0]=e[16],e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.bytes<<3,e[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},n.prototype.hash=function(){var e,o,s,t,i,r,a=this.blocks;this.first?(e=a[0]-680876937,e=(e<<7|e>>>25)-271733879<<0,t=(-1732584194^e&2004318071)+a[1]-117830708,t=(t<<12|t>>>20)+e<<0,s=(-271733879^t&(e^-271733879))+a[2]-1126478375,s=(s<<17|s>>>15)+t<<0,o=(e^s&(t^e))+a[3]-1316259209,o=(o<<22|o>>>10)+s<<0):(e=this.h0,o=this.h1,s=this.h2,t=this.h3,e+=(t^o&(s^t))+a[0]-680876936,e=(e<<7|e>>>25)+o<<0,t+=(s^e&(o^s))+a[1]-389564586,t=(t<<12|t>>>20)+e<<0,s+=(o^t&(e^o))+a[2]+606105819,s=(s<<17|s>>>15)+t<<0,o+=(e^s&(t^e))+a[3]-1044525330,o=(o<<22|o>>>10)+s<<0),e+=(t^o&(s^t))+a[4]-176418897,e=(e<<7|e>>>25)+o<<0,t+=(s^e&(o^s))+a[5]+1200080426,t=(t<<12|t>>>20)+e<<0,s+=(o^t&(e^o))+a[6]-1473231341,s=(s<<17|s>>>15)+t<<0,o+=(e^s&(t^e))+a[7]-45705983,o=(o<<22|o>>>10)+s<<0,e+=(t^o&(s^t))+a[8]+1770035416,e=(e<<7|e>>>25)+o<<0,t+=(s^e&(o^s))+a[9]-1958414417,t=(t<<12|t>>>20)+e<<0,s+=(o^t&(e^o))+a[10]-42063,s=(s<<17|s>>>15)+t<<0,o+=(e^s&(t^e))+a[11]-1990404162,o=(o<<22|o>>>10)+s<<0,e+=(t^o&(s^t))+a[12]+1804603682,e=(e<<7|e>>>25)+o<<0,t+=(s^e&(o^s))+a[13]-40341101,t=(t<<12|t>>>20)+e<<0,s+=(o^t&(e^o))+a[14]-1502002290,s=(s<<17|s>>>15)+t<<0,o+=(e^s&(t^e))+a[15]+1236535329,o=(o<<22|o>>>10)+s<<0,e+=(s^t&(o^s))+a[1]-165796510,e=(e<<5|e>>>27)+o<<0,t+=(o^s&(e^o))+a[6]-1069501632,t=(t<<9|t>>>23)+e<<0,s+=(e^o&(t^e))+a[11]+643717713,s=(s<<14|s>>>18)+t<<0,o+=(t^e&(s^t))+a[0]-373897302,o=(o<<20|o>>>12)+s<<0,e+=(s^t&(o^s))+a[5]-701558691,e=(e<<5|e>>>27)+o<<0,t+=(o^s&(e^o))+a[10]+38016083,t=(t<<9|t>>>23)+e<<0,s+=(e^o&(t^e))+a[15]-660478335,s=(s<<14|s>>>18)+t<<0,o+=(t^e&(s^t))+a[4]-405537848,o=(o<<20|o>>>12)+s<<0,e+=(s^t&(o^s))+a[9]+568446438,e=(e<<5|e>>>27)+o<<0,t+=(o^s&(e^o))+a[14]-1019803690,t=(t<<9|t>>>23)+e<<0,s+=(e^o&(t^e))+a[3]-187363961,s=(s<<14|s>>>18)+t<<0,o+=(t^e&(s^t))+a[8]+1163531501,o=(o<<20|o>>>12)+s<<0,e+=(s^t&(o^s))+a[13]-1444681467,e=(e<<5|e>>>27)+o<<0,t+=(o^s&(e^o))+a[2]-51403784,t=(t<<9|t>>>23)+e<<0,s+=(e^o&(t^e))+a[7]+1735328473,s=(s<<14|s>>>18)+t<<0,o+=(t^e&(s^t))+a[12]-1926607734,o=(o<<20|o>>>12)+s<<0,i=o^s,e+=(i^t)+a[5]-378558,e=(e<<4|e>>>28)+o<<0,t+=(i^e)+a[8]-2022574463,t=(t<<11|t>>>21)+e<<0,r=t^e,s+=(r^o)+a[11]+1839030562,s=(s<<16|s>>>16)+t<<0,o+=(r^s)+a[14]-35309556,o=(o<<23|o>>>9)+s<<0,i=o^s,e+=(i^t)+a[1]-1530992060,e=(e<<4|e>>>28)+o<<0,t+=(i^e)+a[4]+1272893353,t=(t<<11|t>>>21)+e<<0,r=t^e,s+=(r^o)+a[7]-155497632,s=(s<<16|s>>>16)+t<<0,o+=(r^s)+a[10]-1094730640,o=(o<<23|o>>>9)+s<<0,i=o^s,e+=(i^t)+a[13]+681279174,e=(e<<4|e>>>28)+o<<0,t+=(i^e)+a[0]-358537222,t=(t<<11|t>>>21)+e<<0,r=t^e,s+=(r^o)+a[3]-722521979,s=(s<<16|s>>>16)+t<<0,o+=(r^s)+a[6]+76029189,o=(o<<23|o>>>9)+s<<0,i=o^s,e+=(i^t)+a[9]-640364487,e=(e<<4|e>>>28)+o<<0,t+=(i^e)+a[12]-421815835,t=(t<<11|t>>>21)+e<<0,r=t^e,s+=(r^o)+a[15]+530742520,s=(s<<16|s>>>16)+t<<0,o+=(r^s)+a[2]-995338651,o=(o<<23|o>>>9)+s<<0,e+=(s^(o|~t))+a[0]-198630844,e=(e<<6|e>>>26)+o<<0,t+=(o^(e|~s))+a[7]+1126891415,t=(t<<10|t>>>22)+e<<0,s+=(e^(t|~o))+a[14]-1416354905,s=(s<<15|s>>>17)+t<<0,o+=(t^(s|~e))+a[5]-57434055,o=(o<<21|o>>>11)+s<<0,e+=(s^(o|~t))+a[12]+1700485571,e=(e<<6|e>>>26)+o<<0,t+=(o^(e|~s))+a[3]-1894986606,t=(t<<10|t>>>22)+e<<0,s+=(e^(t|~o))+a[10]-1051523,s=(s<<15|s>>>17)+t<<0,o+=(t^(s|~e))+a[1]-2054922799,o=(o<<21|o>>>11)+s<<0,e+=(s^(o|~t))+a[8]+1873313359,e=(e<<6|e>>>26)+o<<0,t+=(o^(e|~s))+a[15]-30611744,t=(t<<10|t>>>22)+e<<0,s+=(e^(t|~o))+a[6]-1560198380,s=(s<<15|s>>>17)+t<<0,o+=(t^(s|~e))+a[13]+1309151649,o=(o<<21|o>>>11)+s<<0,e+=(s^(o|~t))+a[4]-145523070,e=(e<<6|e>>>26)+o<<0,t+=(o^(e|~s))+a[11]-1120210379,t=(t<<10|t>>>22)+e<<0,s+=(e^(t|~o))+a[2]+718787259,s=(s<<15|s>>>17)+t<<0,o+=(t^(s|~e))+a[9]-343485551,o=(o<<21|o>>>11)+s<<0,this.first?(this.h0=e+1732584193<<0,this.h1=o-271733879<<0,this.h2=s-1732584194<<0,this.h3=t+271733878<<0,this.first=!1):(this.h0=this.h0+e<<0,this.h1=this.h1+o<<0,this.h2=this.h2+s<<0,this.h3=this.h3+t<<0)},n.prototype.hex=function(){this.finalize();var e=this.h0,o=this.h1,s=this.h2,t=this.h3;return p[e>>>4&15]+p[e&15]+p[e>>>12&15]+p[e>>>8&15]+p[e>>>20&15]+p[e>>>16&15]+p[e>>>28&15]+p[e>>>24&15]+p[o>>>4&15]+p[o&15]+p[o>>>12&15]+p[o>>>8&15]+p[o>>>20&15]+p[o>>>16&15]+p[o>>>28&15]+p[o>>>24&15]+p[s>>>4&15]+p[s&15]+p[s>>>12&15]+p[s>>>8&15]+p[s>>>20&15]+p[s>>>16&15]+p[s>>>28&15]+p[s>>>24&15]+p[t>>>4&15]+p[t&15]+p[t>>>12&15]+p[t>>>8&15]+p[t>>>20&15]+p[t>>>16&15]+p[t>>>28&15]+p[t>>>24&15]},n.prototype.toString=n.prototype.hex,n.prototype.digest=function(){this.finalize();var e=this.h0,o=this.h1,s=this.h2,t=this.h3;return[e&255,e>>>8&255,e>>>16&255,e>>>24&255,o&255,o>>>8&255,o>>>16&255,o>>>24&255,s&255,s>>>8&255,s>>>16&255,s>>>24&255,t&255,t>>>8&255,t>>>16&255,t>>>24&255]},n.prototype.array=n.prototype.digest,n.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(16),o=new Uint32Array(e);return o[0]=this.h0,o[1]=this.h1,o[2]=this.h2,o[3]=this.h3,e},n.prototype.buffer=n.prototype.arrayBuffer,n.prototype.base64=function(){for(var e,o,s,t="",i=this.array(),r=0;r<15;)e=i[r++],o=i[r++],s=i[r++],t+=C[e>>>2]+C[(e<<4|o>>>4)&63]+C[(o<<2|s>>>6)&63]+C[s&63];return e=i[r],t+=C[e>>>2]+C[e<<4&63]+"==",t};function l(e,o){var s,t=S(e);if(e=t[0],t[1]){var i=[],r=e.length,a=0,f;for(s=0;s<r;++s)f=e.charCodeAt(s),f<128?i[a++]=f:f<2048?(i[a++]=192|f>>>6,i[a++]=128|f&63):f<55296||f>=57344?(i[a++]=224|f>>>12,i[a++]=128|f>>>6&63,i[a++]=128|f&63):(f=65536+((f&1023)<<10|e.charCodeAt(++s)&1023),i[a++]=240|f>>>18,i[a++]=128|f>>>12&63,i[a++]=128|f>>>6&63,i[a++]=128|f&63);e=i}e.length>64&&(e=new n(!0).update(e).array());var U=[],j=[];for(s=0;s<64;++s){var se=e[s]||0;U[s]=92^se,j[s]=54^se}n.call(this,o),this.update(j),this.oKeyPad=U,this.inner=!0,this.sharedMemory=o}l.prototype=new n,l.prototype.finalize=function(){if(n.prototype.finalize.call(this),this.inner){this.inner=!1;var e=this.array();n.call(this,this.sharedMemory),this.update(this.oKeyPad),this.update(e),n.prototype.finalize.call(this)}};var w=H();w.md5=w,w.md5.hmac=W(),N?B.exports=w:m.md5=w})()})(ne);var Ie=ne.exports;const Ue=de(Ie),z=B=>(ce("data-v-4c44ce4f"),B=B(),pe(),B),Re=z(()=>d("i",{class:"xnr-icon-phone icon"},null,-1)),Ee=z(()=>d("i",{class:"xnr-icon-password icon"},null,-1)),Ve={key:1},Oe={class:"send-email-panel"},Ae=z(()=>d("i",{class:"xnr-icon-yanzheng icon"},null,-1)),$e=z(()=>d("div",null,[d("p",null,"请稍等一会，再次点击获取")],-1)),De=z(()=>d("span",{class:"a-link",style:{"font-size":"12px"}},"未收到手机验证码？",-1)),Se=z(()=>d("i",{class:"xnr-icon-name icon"},null,-1)),Pe=z(()=>d("i",{class:"xnr-icon-password icon"},null,-1)),Me=z(()=>d("i",{class:"xnr-icon-password icon"},null,-1)),ze={class:"check-code-panel"},Be=z(()=>d("i",{class:"xnr-icon-yanzheng icon"},null,-1)),Ne=["src"],je={class:"rem-panel"},Je={class:"no-account"},Le={key:0},qe={key:1},He={key:2},Te={class:"check-code-panel"},Ke=z(()=>d("span",null,"icon",-1)),We=["src"],Ye={__name:"LoginAndRegister",setup(B,{expose:$}){const O=le(),{proxy:g}=oe();ee(),te();const m={checkCode:"/api/checkCode",sendEmailCode:"/sendEmailCode",register:"/register",login:"/login",resetPwd:"resetPwd"},h=R(),b=n=>{h.value=n,k()};$({showPanel:b});const N=(n,l,w)=>{l!==_.value.registerPassword?w(new Error(n.message)):w()},_=R({}),p=R(),q={email:[{required:!0,message:"请输入邮箱"},{validator:g.Verify.email,message:"请输入正确的邮箱"}],password:[{required:!0,message:"请输入密码"}],emailCode:[{required:!0,message:"请输入邮箱验证码"}],nickName:[{required:!0,message:"请输入昵称"}],registerPassword:[{required:!0,message:"请输入密码"},{validator:g.Verify.password,message:"密码只能是数字，字母，特殊字符，长度8-18位"}],reRegisterPassword:[{required:!0,message:"请再次输入密码"},{validator:N,message:"两次输入的密码不一致"}],checkCode:[{required:!0,message:"请输入图片验证码"}]},k=()=>{v.show=!0,h.value==0?v.title="注册":h.value==1?v.title="登录":h.value==2&&(v.title="重置密码"),Q(()=>{if(P(0),p.value.resetFields(),_.value={},h.value==1){const n=g.VueCookies.get("loginInfo");n&&(_.value=n)}})},v=Y({show:!1,title:"标题"}),C=R({}),x=R(),E=Y({show:!1,title:"发送邮箱验证码",buttons:[{type:"primary",text:"发送验证码",click:()=>{D()}}]}),A=()=>{p.value.validateField("email",n=>{n&&(E.show=!0,Q(()=>{P(1),x.value.resetFields(),C.value={email:_.value.email}}))})},D=()=>{x.value.validate(async n=>{if(!n)return;const l=Object.assign({},C.value);l.type=h.value==0?0:1,await g.Request({url:m.sendEmailCode,params:l,errorCallback:()=>{P(1)}})&&(g.Message.success("验证码发送成功"),E.show=!1)})},F=Y({passwordEyeOpen:!1,registerPasswordEyeOpen:!1,reRegisterPasswordEyeOpen:!1}),S=n=>{F[n]=!F[n]},I=R(m.checkCode),H=R(m.checkCode),P=n=>{n==0?I.value=m.checkCode+"?type="+n+"&time="+new Date().getTime():H.value=m.checkCode+"?type="+n+"&time="+new Date().getTime()},T=()=>{p.value.validate(async n=>{if(!n)return;const l=Object.assign({},_.value);if((h.value==0||h.value==2)&&(l.password=l.registerPassword,delete l.registerPassword,delete l.reRegisterPassword),h.value==1){let o=g.VueCookies.get("loginInfo"),s=o==null?null:o.password;l.password!==s&&(l.password=Ue(l.password))}let w=null;h.value==0?w=m.register:h.value==1?w=m.login:h.value==2&&(w=m.resetPwd);let e=await g.Request({url:w,params:l,errorCallback:()=>{P(0)}});if(e)if(h.value==0)g.Message.success("注册成功，请登录"),b(1);else if(h.value==1){if(l.remMe){const o={email:l.email,password:l.password,remMe:l.remMe};g.VueCookies.set("loginInfo",o,"7d")}else g.VueCookies.remove("loginInfo");v.show=!1,g.Message.success("登录成功"),O.commit("updateLoginUserInfo",e.data)}else h.value==2&&(g.Message.success("重置密码成功，请登录"),b(1))})},W=()=>{v.show=!1,O.commit("showLogin",!1)};return(n,l)=>{const w=y("el-input"),e=y("el-form-item"),o=y("el-button"),s=y("el-popover"),t=y("el-checkbox"),i=y("el-form"),r=y("aDialog");return V(),J("div",null,[c(r,{show:v.show,buttons:v.buttons,title:v.title,width:"400px",showCancel:!1,onClose:W},{default:u(()=>[c(i,{rules:q,ref_key:"formDataRef",ref:p,model:_.value,class:"login-register"},{default:u(()=>[c(e,{prop:"email"},{default:u(()=>[c(w,{clearable:"",placeholder:"请输入邮箱",size:"large",modelValue:_.value.email,"onUpdate:modelValue":l[0]||(l[0]=a=>_.value.email=a),maxlength:"150"},{prefix:u(()=>[Re]),_:1},8,["modelValue"])]),_:1}),h.value==1?(V(),K(e,{key:0,prop:"password"},{default:u(()=>[c(w,{placeholder:"请输入密码",size:"large",modelValue:_.value.password,"onUpdate:modelValue":l[2]||(l[2]=a=>_.value.password=a),type:F.passwordEyeOpen?"text":"password"},{prefix:u(()=>[Ee]),suffix:u(()=>[d("span",{class:G(["iconfont",F.passwordEyeOpen?"xnr-icon-zhengyan":"xnr-icon-biyan"]),onClick:l[1]||(l[1]=a=>S("passwordEyeOpen"))},null,2)]),_:1},8,["modelValue","type"])]),_:1})):M("",!0),h.value==0||h.value==2?(V(),J("div",Ve,[c(e,{prop:"emailCode"},{default:u(()=>[d("div",Oe,[c(w,{clearable:"",placeholder:"请输入邮箱验证码",size:"large",modelValue:_.value.emailCode,"onUpdate:modelValue":l[3]||(l[3]=a=>_.value.emailCode=a)},{prefix:u(()=>[Ae]),_:1},8,["modelValue"]),c(o,{type:"primary",size:"large",class:"send-email-btn",onClick:A},{default:u(()=>[L("获取验证码")]),_:1})]),c(s,{placement:"left",width:250,trigger:"click"},{reference:u(()=>[De]),default:u(()=>[$e]),_:1})]),_:1}),h.value==0?(V(),K(e,{key:0,prop:"nickName"},{default:u(()=>[c(w,{clearable:"",placeholder:"请输入昵称",size:"large",modelValue:_.value.nickName,"onUpdate:modelValue":l[4]||(l[4]=a=>_.value.nickName=a),maxlength:"20"},{prefix:u(()=>[Se]),_:1},8,["modelValue"])]),_:1})):M("",!0),c(e,{prop:"registerPassword"},{default:u(()=>[c(w,{placeholder:"请输入密码",size:"large",modelValue:_.value.registerPassword,"onUpdate:modelValue":l[6]||(l[6]=a=>_.value.registerPassword=a),type:F.registerPasswordEyeOpen?"text":"password"},{prefix:u(()=>[Pe]),suffix:u(()=>[d("span",{class:G(["iconfont",F.registerPasswordEyeOpen?"xnr-icon-zhengyan":"xnr-icon-biyan"]),onClick:l[5]||(l[5]=a=>S("registerPasswordEyeOpen"))},null,2)]),_:1},8,["modelValue","type"])]),_:1}),c(e,{prop:"reRegisterPassword"},{default:u(()=>[c(w,{placeholder:"请再次输入密码",size:"large",modelValue:_.value.reRegisterPassword,"onUpdate:modelValue":l[8]||(l[8]=a=>_.value.reRegisterPassword=a),type:F.reRegisterPasswordEyeOpen?"text":"password"},{prefix:u(()=>[Me]),suffix:u(()=>[d("span",{class:G(["iconfont",F.reRegisterPasswordEyeOpen?"xnr-icon-zhengyan":"xnr-icon-biyan"]),onClick:l[7]||(l[7]=a=>S("reRegisterPasswordEyeOpen"))},null,2)]),_:1},8,["modelValue","type"])]),_:1})])):M("",!0),c(e,{prop:"checkCode"},{default:u(()=>[d("div",ze,[c(w,{clearable:"",placeholder:"请输入验证码",size:"large",modelValue:_.value.checkCode,"onUpdate:modelValue":l[9]||(l[9]=a=>_.value.checkCode=a)},{prefix:u(()=>[Be]),_:1},8,["modelValue"]),d("img",{src:I.value,alt:"验证码",class:"code",onClick:l[10]||(l[10]=a=>P(0))},null,8,Ne)])]),_:1}),h.value==1?(V(),K(e,{key:2},{default:u(()=>[d("div",je,[c(t,{modelValue:_.value.remMe,"onUpdate:modelValue":l[11]||(l[11]=a=>_.value.remMe=a)},{default:u(()=>[L("记住我")]),_:1},8,["modelValue"])]),d("div",Je,[d("a",{class:"a-link",href:"javascript:void(0)",onClick:l[12]||(l[12]=a=>b(2))},"忘记密码？"),d("a",{class:"a-link",href:"javascript:void(0)",onClick:l[13]||(l[13]=a=>b(0))},"没有账号")])]),_:1})):M("",!0),h.value==0?(V(),K(e,{key:3},{default:u(()=>[d("a",{class:"a-link",href:"javascript:void(0)",onClick:l[14]||(l[14]=a=>b(1))},"已有账号？")]),_:1})):M("",!0),h.value==2?(V(),K(e,{key:4},{default:u(()=>[d("a",{class:"a-link",href:"javascript:void(0)",onClick:l[15]||(l[15]=a=>b(1))},"去登录？")]),_:1})):M("",!0),c(e,null,{default:u(()=>[c(o,{type:"primary",class:"op-btn",onClick:T},{default:u(()=>[h.value==0?(V(),J("span",Le,"注册")):M("",!0),h.value==1?(V(),J("span",qe,"登录")):M("",!0),h.value==2?(V(),J("span",He,"重置密码")):M("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","buttons","title"]),c(r,{show:E.show,buttons:E.buttons,title:E.title,width:"500px",showCancel:!1,onClose:l[18]||(l[18]=a=>E.show=!1)},{default:u(()=>[c(i,{rules:q,ref_key:"formDataRef4SendCode",ref:x,model:C.value,"label-width":"80px"},{default:u(()=>[c(e,{label:"邮箱"},{default:u(()=>[L(re(_.value.email),1)]),_:1}),c(e,{label:"验证码",prop:"checkCode"},{default:u(()=>[d("div",Te,[c(w,{clearable:"",placeholder:"请输入验证码",size:"large",modelValue:C.value.checkCode,"onUpdate:modelValue":l[16]||(l[16]=a=>C.value.checkCode=a)},{prefix:u(()=>[Ke]),_:1},8,["modelValue"]),d("img",{src:H.value,alt:"验证码",class:"code",onClick:l[17]||(l[17]=a=>P(1))},null,8,We)])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","buttons","title"])])}}},Ge=fe(Ye,[["__scopeId","data-v-4c44ce4f"]]),Xe={class:"header"},Ze=d("div",{class:"logo"},[d("img",{src:be,alt:""})],-1),Qe={class:"search"},et={key:0,class:"set"},tt={class:"nav"},ot=d("i",{class:"xnr-icon-shouye icon"},null,-1),st=d("span",null,"首页",-1),at=[ot,st],rt=d("i",{class:"xnr-icon-wenda icon"},null,-1),lt=d("span",null,"搜索",-1),nt=[rt,lt],it=d("i",{class:"xnr-icon-fabu icon"},null,-1),ut=d("span",null,"发布",-1),dt=[it,ut],ft=d("i",{class:"xnr-icon-xiaoxi icon"},null,-1),ct=d("span",null,"消息",-1),pt=d("i",{class:"xnr-icon-my icon"},null,-1),ht=d("span",null,"我的",-1),_t=[pt,ht],vt={key:1},mt=d("span",null," 登  录",-1),xt=[mt],gt=d("span",null,"注  册",-1),wt=[gt],yt={class:"main"},Ct={__name:"Layout",setup(B){const{proxy:$}=oe(),O=ee();te();const g=le(),m=R({}),h=R(),b={keyword:[{min:3,message:"关键字太少，至少三个字"}]},N=()=>{m.value.keyword==""&&(cardList.value=[])},_=()=>{O.push("/")},p=()=>{O.push("/search")},q=()=>{g.getters.getLoginUserInfo?O.push("/publish"):A(1)},k=()=>{g.getters.getLoginUserInfo?O.push("/message"):A(1)},v=n=>{O.push(`/user/${n}`)},C=R(""),x=()=>{console.log("search"),C.value=m.value.keyword,O.push(`/forum/search/${C.value}`)},E=R(),A=n=>{E.value.showPanel(n)};he(()=>{D()});const D=async()=>{let n=await ge();n&&g.commit("updateLoginUserInfo",n.data)},F=R({}),S=async()=>{let n=await ye();n&&(F.value=n.data,g.commit("updateMessageCountInfo",n.data))};X(()=>g.state.messageCountInfo,(n,l)=>{F.value=n||{}},{immediate:!0,deep:!0});const I=R({});X(()=>g.state.loginUserInfo,(n,l)=>{n!=null&&n!=null?(I.value=n,S()):I.value={}},{immediate:!0,deep:!0}),X(()=>g.state.showLogin,(n,l)=>{n&&A(1)},{immediate:!0,deep:!0});const H=R(null),P=()=>{H.value.showEditUserInfoDialog(I.value)},T=n=>{I.value=n},W=()=>{$.Confirm("确定退出吗？",async()=>{await we()&&g.commit("updateLoginUserInfo",null)})};return(n,l)=>{const w=y("el-input"),e=y("el-button"),o=y("el-form-item"),s=y("el-form"),t=y("avatar"),i=y("el-dropdown-item"),r=y("el-dropdown-menu"),a=y("el-dropdown"),f=y("el-badge"),U=y("router-view");return V(),J("div",null,[d("div",Xe,[Ze,d("div",Qe,[c(s,{ref_key:"formDataRef",ref:h,model:m.value,rules:b},{default:u(()=>[c(o,{prop:"keyword"},{default:u(()=>[c(w,{placeholder:"请输入查找的关键词",style:{width:"400px"},size:"large","prefix-icon":Z(ve),modelValue:m.value.keyword,"onUpdate:modelValue":l[0]||(l[0]=j=>m.value.keyword=j),onKeyup:me(x,["enter"]),onChange:N,clearable:""},null,8,["prefix-icon","modelValue"]),c(e,{type:"success",size:"large",style:{"margin-left":"15px"},onClick:x,onBlur:l[1]||(l[1]=j=>m.value.keyword=j.target.value.trim())},{default:u(()=>[L("搜索")]),_:1})]),_:1})]),_:1},8,["model"])]),I.value.userId?(V(),J("div",et,[c(a,null,{dropdown:u(()=>[c(r,{slot:"dropdown"},{default:u(()=>[c(i,{onClick:P},{default:u(()=>[L("修改资料")]),_:1}),c(i,{onClick:W},{default:u(()=>[L("退出")]),_:1})]),_:1})]),default:u(()=>[c(t,{userId:I.value.userId},null,8,["userId"])]),_:1})])):M("",!0)]),d("div",{class:"aside",style:_e({height:Z($).globalInfo.bodyHeight+"px"})},[d("div",tt,[d("div",{class:"ban",onClick:_},at),d("div",{class:"ban",onClick:p},nt),d("div",{class:"ban",onClick:q},dt),d("div",{class:"ban",onClick:k},[c(f,{value:F.value.total,hidden:F.value.total==null||F.value.total==0,class:"badge-item"},{default:u(()=>[ft,ct]),_:1},8,["value","hidden"])]),I.value.userId?(V(),J("div",{key:0,class:"ban avaban",onClick:l[2]||(l[2]=j=>v(I.value.userId))},_t)):(V(),J("div",vt,[d("div",{class:"ban login",onClick:l[3]||(l[3]=j=>A(1))},xt),d("div",{class:"ban login",onClick:l[4]||(l[4]=j=>A(0))},wt)]))])],4),c(Ge,{ref_key:"loginRegisterRef",ref:E},null,512),d("div",yt,[c(U)]),c(ke,{ref_key:"userEditInfoRef",ref:H,onResetUserInfo:T},null,512)])}}};export{Ct as default};
