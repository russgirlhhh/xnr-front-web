import{u as C,a as D,b as p,z as R,c as d,o as q,m as E,e as t,w as o,p as n,f as H,h as T,n as L,L as N}from"./index-CEFTijA-.js";const P={class:"edit-post"},O={class:"post-editor"},z=n("div",{class:"post-editor-title"},[n("span",null,"正文")],-1),F={class:"post-setting"},M=n("span",null,"设置",-1),j={class:"setting-inner"},J={__name:"Publish",setup(S){const{proxy:u}=T(),_=C(),g=D(),I=window.innerHeight-300,i={loadBoard:"/forum/loadBoard4Post",postArticle:"/forum/postArticle",articleDetail4Update:"/forum/articleDetail4Update",updateArticle:"/forum/updateArticle"},m=p(null),y=()=>{L(async()=>{if(f.value.resetFields(),m.value){let l=await u.Request({url:i.articleDetail4Update,params:{articleId:m.value},showError:!1,errorCallback:c=>{N.alert(c.info,"错误",{"show-close":!1,callback:r=>{_.go(-1)}})}});if(!l)return;let e=l.data.forumArticle;e.boardIds=[],e.boardIds.push(e.pBoardId),e.boardId!=null&&e.boardId!=0&&e.boardIds.push(e.boardId),e.cover&&(e.cover={imageUrl:e.cover}),a.value=e}else a.value={}})};R(()=>g,(l,e)=>{(l.path.indexOf("/rePublish")!=-1||l.path.indexOf("/publish")!=-1)&&(m.value=l.params.articleId,y())},{immediate:!0,deep:!0});const a=p({}),f=p(),x={title:[{required:!0,message:"请输入标题"}],boardIds:[{required:!0,message:"请选择板块"}],content:[{required:!0,message:"请输入正文"}]},V=()=>{f.value.validate(async l=>{if(!l)return;let e={};if(Object.assign(e,a.value),e.boardIds.length==1?e.pBoardId=e.boardIds[0]:e.boardIds.length==2&&(e.pBoardId=e.boardIds[0],e.boardId=e.boardIds[1]),delete e.boardIds,e.editorType=0,e.content.replace(/<(?!img).*?>/g,"")==""){u.message.warning("正文不能为空");return}e.cover instanceof File||delete e.cover,console.log("--",e);let r=await u.Request({url:e.articleId?i.updateArticle:i.postArticle,params:e});console.log(r),r&&(u.Message.success("保存成功"),_.push(`/post/${r.data}`))})},w={multiple:!1,checkStrictly:!0,value:"boardId",label:"boardName"},b=p([]);return(async()=>{let l=await u.Request({url:i.loadBoard});l&&(b.value=l.data)})(),(l,e)=>{const c=d("EditorHtml"),r=d("el-form-item"),v=d("el-card"),h=d("el-input"),B=d("el-cascader"),U=d("CoverUpload"),k=d("el-button"),A=d("el-form");return q(),E("div",P,[t(A,{model:a.value,rules:x,ref_key:"formDataRef",ref:f,class:"post-panel","label-width":"60px"},{default:o(()=>[n("div",O,[t(v,{"body-style":{padding:"5px"}},{header:o(()=>[z]),default:o(()=>[t(r,{prop:"content","label-width":"0"},{default:o(()=>[t(c,{height:I,modelValue:a.value.content,"onUpdate:modelValue":e[0]||(e[0]=s=>a.value.content=s)},null,8,["modelValue"])]),_:1})]),_:1})]),n("div",F,[t(v,{"body-style":{padding:"5px"}},{header:o(()=>[M]),default:o(()=>[n("div",j,[t(r,{label:"标题",prop:"title"},{default:o(()=>[t(h,{clearable:"",maxlength:150,placeholder:"提示信息",modelValue:a.value.title,"onUpdate:modelValue":e[1]||(e[1]=s=>a.value.title=s)},null,8,["modelValue"])]),_:1}),t(r,{label:"板块",prop:"boardIds"},{default:o(()=>[t(B,{placeholder:"请选择板块",options:b.value,props:w,clearable:"",modelValue:a.value.boardIds,"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.boardIds=s),style:{width:"100%"}},null,8,["options","modelValue"])]),_:1}),t(r,{label:"封面",prop:"cover"},{default:o(()=>[t(U,{modelValue:a.value.cover,"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.cover=s)},null,8,["modelValue"])]),_:1}),t(r,{label:"摘要",prop:"summary"},{default:o(()=>[t(h,{clearable:"",placeholder:"提示信息",type:"textarea",rows:5,maxlength:200,resize:"none","show-word-limit":"",modelValue:a.value.summary,"onUpdate:modelValue":e[4]||(e[4]=s=>a.value.summary=s)},null,8,["modelValue"])]),_:1}),t(r,{label:"",prop:""},{default:o(()=>[t(k,{type:"primary",style:{width:"100%"},onClick:V},{default:o(()=>[H("保存")]),_:1})]),_:1})])]),_:1})])]),_:1},8,["model"])])}}};export{J as default};
